customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.submitButton=this.querySelector('[type="submit"]')}async onSubmitHandler(evt){if(evt.preventDefault(),this.submitButton.getAttribute("aria-disabled")==="true")return;this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.classList.add("loading"),this.submitButton.querySelector(".button__label").classList.add("hidden"),this.querySelector(".loading-overlay__spinner").classList.remove("hidden");const productDetails=JSON.parse(this.querySelector("[data-product-json]").textContent),config={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}};config.headers["X-Requested-With"]="XMLHttpRequest",delete config.headers["Content-Type"];const formData=new FormData(this.form),showMiniCart=formData.get("show_mini_cart")==="true",redirectToCartOnAddProduct=formData.get("redirect_to_cart_on_add_product")==="true",giftWrapping=document.querySelector("gift-wrapping");if(giftWrapping&&giftWrapping.querySelector(".disclosure__link--active").dataset.value!=""){const giftWrappingId=giftWrapping.querySelector(".disclosure__link--active").dataset.value,giftWrappingName=giftWrapping.querySelector(".disclosure__link--active").dataset.name,variantId=this.form.querySelector('[name="items[0]id"]').value,parentKey=window.btoa([giftWrappingId,variantId].join(","));formData.append("items[0]properties[_itemKey]",parentKey),formData.append(`items[0]properties[${window.variantStrings.gift_wrapping.wrapping_property_label||"Gift wrapping"}]`,giftWrappingName),formData.append("items[1]id",giftWrappingId),formData.append("items[1]properties[_parentKey]",parentKey),formData.append("items[1]properties[_giftWrapping]","true"),formData.append(`items[1]properties[${window.variantStrings.gift_wrapping.product_property_label||"Product"}]`,productDetails.product.title)}config.body=formData;let gotError=!1;try{const res=await fetch(routes.cart_add_url+".js",config),json=await res.json();if(res.status!==200)throw json.description?.email?new Error(json.description.email):json.description?.message?new Error(json.description.message):json.description?.name?new Error(json.description.name):new Error(json.description);const productQuantity=formData.get("quantity");document.dispatchEvent(new CustomEvent("ajaxProduct:added",{detail:{json,showMiniCart}}));const isBundle=json?.items?.[0]&&!json?.items?.[0]?.sku;document.dispatchEvent(new CustomEvent("datalayer:productAdded",{detail:{product:productDetails,quantity:productQuantity?parseInt(productQuantity):1,price:json?.items?.[0]?.price,bundled:isBundle,...isBundle?{bundleProduct:{title:productDetails.product.title,handle:productDetails.product.handle}}:{},affiliatePartner:window.localStorage.getItem("affiliatePartner"),affiliateId:window.localStorage.getItem("affiliateId"),ttp:window.getCookieValue("_ttp"),ttclid:window.getCookieValue("ttclid"),eventId:crypto.randomUUID()}})),!showMiniCart&&redirectToCartOnAddProduct&&setTimeout(()=>{window.location.pathname=window.routes.cart_url},100)}catch(error){gotError=!0,this.handleErrorMessage(error),console.error(error)}this.querySelector(".loading-overlay__spinner").classList.add("hidden");let completedTimeout=2e3;gotError?completedTimeout=0:(setTimeout(()=>{this.querySelector(".loading-overlay__completed").classList.remove("hidden")},100),this.querySelector(".product-form_cart-link")?.classList.remove("hidden")),setTimeout(()=>{this.submitButton.classList.remove("loading"),this.submitButton.removeAttribute("aria-disabled"),this.submitButton.querySelector(".button__label").classList.remove("hidden"),this.querySelector(".loading-overlay__completed").classList.add("hidden")},completedTimeout)}handleErrorMessage(errorMessage=!1){this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!errorMessage),errorMessage&&(this.errorMessage.textContent=errorMessage))}});
//# sourceMappingURL=/cdn/shop/t/96/assets/component-product-form.js.map?v=143320681722500880521744203262
