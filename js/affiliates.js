(function(){class Affiliate{partners=[{partner:"awin",key:"awc",dtl:30},{partner:"tradedoubler",key:"tduid",dtl:30},{partner:"adtraction",key:"at_gd",dtl:30},{partner:"rakuten",key:"ranSiteID",dtl:30}];set(){const urlParams=new URLSearchParams(window.location.search),partnerConfig=this.partners.find(aff=>!!urlParams.get(aff.key));partnerConfig&&(window.localStorage.setItem("affiliatePartner",partnerConfig.partner),window.localStorage.setItem("affiliateId",urlParams.get(partnerConfig.key)),window.localStorage.setItem("affiliateLandDate",new Date().getTime()),window.localStorage.setItem("affiliateValidUntil",new Date().getTime()+1e3*60*60*24*partnerConfig.dtl))}get(){const affiliatePartner=window.localStorage.getItem("affiliatePartner");if(!affiliatePartner)return{};const partnerConfig=this.partners.find(aff=>aff.partner===affiliatePartner);if(!partnerConfig)return{};const validUntil=window.localStorage.getItem("affiliateValidUntil");let validUntilNumber=parseInt(validUntil);return validUntilNumber||(validUntilNumber=new Date().getTime()+1e3*60*60*24*partnerConfig.dtl,window.localStorage.setItem("affiliateValidUntil",validUntilNumber)),validUntilNumber&&new Date().getTime()<validUntilNumber?{partner:affiliatePartner,id:window.localStorage.getItem("affiliateId"),landDate:window.localStorage.getItem("affiliateLandDate")}:{}}clear(){window.localStorage.removeItem("affiliatePartner"),window.localStorage.removeItem("affiliateId"),window.localStorage.removeItem("affiliateLandDate"),window.localStorage.removeItem("affiliateValidUntil")}}const affiliate=new Affiliate;let debounceTimer;const setCartAttributes=function(attributes){debounceTimer&&clearTimeout(debounceTimer),debounceTimer=setTimeout(()=>{window.updateCart({method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({attributes})})},100)},removeTiktokCookies=function(){const removedCookies=[...window.removeCookie("ttclid")?["ttclid"]:[],...window.removeCookie("_ttp")?["_ttp"]:[]];window.removeCookie("_tt_enable_cookie"),removedCookies.length>0&&setCartAttributes(removedCookies.map(c=>c.startsWith("_")?c:`_${c}`).reduce((prev,cookie)=>({...prev,[cookie]:""}),{}))};window.addEventListener("CookiebotOnConsentReady",()=>{window.Cookiebot.consent.marketing?affiliate.set():(removeTiktokCookies(),affiliate.clear())}),document.addEventListener("DOMContentLoaded",()=>{let consentStatus;const consentCookie=document.cookie.split(";").find(cookie=>cookie.trim().startsWith("_tracking_consent="));if(consentCookie){const decodedContent=decodeURIComponent(consentCookie.split("=")[1]),consentObject=JSON.parse(decodedContent);typeof consentObject.con.GDPR<"u"?consentStatus=consentObject.con.GDPR:consentStatus=consentObject.con.CMP.m}else consentStatus=1;consentStatus===1||consentStatus==="1"?affiliate.set():(removeTiktokCookies(),affiliate.clear())}),document.addEventListener("cart:fetch",event=>{let updateAttributes={};const affiliateValue=affiliate.get();affiliateValue.partner!==event.detail?.attributes?._affiliate_partner&&(updateAttributes={...updateAttributes,_affiliate_partner:affiliateValue.partner??""}),affiliateValue.id!==event.detail?.attributes?._affiliate_id&&(updateAttributes={...updateAttributes,_affiliate_id:affiliateValue.id??""}),affiliateValue.landDate!==event.detail?.attributes?._land_date&&(updateAttributes={...updateAttributes,_land_date:affiliateValue.landDate??""});const _ttp=window.getCookieValue("_ttp")||void 0;_ttp!==event.detail?.attributes?._ttp&&(updateAttributes={...updateAttributes,_ttp:_ttp??""});const _ttclid=window.getCookieValue("ttclid")||void 0;_ttclid!==event.detail?.attributes?._ttclid&&(updateAttributes={...updateAttributes,_ttclid:_ttclid??""}),Object.keys(updateAttributes).length>0&&setCartAttributes(updateAttributes)}),window.location.pathname===window.routes.cart_url&&window.fetchCart()})();
//# sourceMappingURL=/cdn/shop/t/96/assets/affiliates.js.map?v=78196696264019548061744203204
